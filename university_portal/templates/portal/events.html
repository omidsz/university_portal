<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>رویدادها</title>
  <style>
    body { font-family: sans-serif; padding: 20px; direction: rtl; }
    .event { border: 1px solid #ccc; margin: 10px 0; padding: 10px; border-radius: 8px; }
    textarea { width: 100%; padding: 5px; }
  </style>
</head>
<body>
  <h2>رویدادها</h2>
  <div id="events"></div>

  <script>
    const token = localStorage.getItem('access_token');

    function postComment(eventId, commentText) {
      fetch('/api/portal/comments/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({
          event: eventId,
          content: commentText
        })
      })
      .then(res => res.json())
      .then(data => {
        alert("نظر ثبت شد");
      })
      .catch(err => alert("خطا در ثبت نظر"));
    }

    fetch('/api/portal/events/')
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById('events');
        data.forEach(event => {
          const div = document.createElement('div');
          div.className = 'event';
          div.innerHTML = `
            <h3>${event.title}</h3>
            <p>${event.description}</p>
            <textarea placeholder="نظر شما..."></textarea>
            <button onclick="postComment(${event.id}, this.previousElementSibling.value)">ارسال نظر</button>
          `;
          container.appendChild(div);
        });
      });
  </script>
</body>
</html>
